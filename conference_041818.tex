\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{algorithm}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{courier}
\usepackage{xcolor}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{Improving Join Reordering for SQL on Big Data Systems without Statistics\\
}

\author{\IEEEauthorblockN{Amogh Margoor}
\IEEEauthorblockA{\textit{Qubole Inc.} \\
Santa Clara, US}
\and
\IEEEauthorblockN{ Mayur Bhosale}
\IEEEauthorblockA{\textit{Qubole Inc.} \\
Bangalore, India}
}

\maketitle

\begin{abstract}
Using Qubole Data Service, customers process around 4 million SQL Joins per month on their Big Data using Apache Spark. Order in which SQL Joins are performed can vary the efficiency and performance of analytical queries significantly. Hence, finding optimal order for SQL Join is a well researched NP-Hard problem. However, like other traditional Cost Based Optimization in Query processing, even traditional Join Reordering algorithms are not effective on Big Data due to lack of statistics. Statistics are mostly absent in Big Data as they are expensive to compute and needs frequent recompute due to velocity of data change. Hence, ensuring optimal order of Joins is still largely a manual process done via trial and error method on Big Data Systems.

We would like to propose a novel greedy algorithm for Join Reordering which can work in the absence of statistics. Proposed technique is of linear complexity in terms of number of joins. We have observed it improving query performance upto 85\% on TPC-DS benchmarks.
\end{abstract}

\begin{IEEEkeywords}
SQL on Big Data, Query Processing, Join Order, Data Management Systems
\end{IEEEkeywords}

\section{Introduction}
Joins are extremely common for analytical workloads on Big Data and optimizing joins can improve the efficiency and performance of such workloads significantly. Qubole Data Service offers 3 prominent SQL engines for Big Data as a service on public clouds like Amazon AWS, Microsoft Azure and Google Cloud Platform: Apache Hive, Presto and Apache Spark. Customers using Qubole Data Service processes 4 million joins per month using just Apache Spark, making it one of the most commonly used SQL operators. Table \ref{tab:stats} specifies some of the Join metrics we collected for a month on Qubole's offering of Apache Spark. We see around 51\% of joins being INNER JOIN and around 55\% of all Joins using Merge Sort Join algorithm. Due to the frequency and the complexity of Joins, Join Order and Join Strategy are two important decision to be made by Optimizers of Big Data Engines. Optimizers of these Big Data engines like Apache Spark uses traditional Dynamic Programming based algorithms \cite{b1} dependent on column level Statistics. Although Join Reordering is extensively researched problem, the techniques are largely dependent on availability of statistics. For instance, Join reordering algorithm in Spark and Presto will not work without column level statistics. Such extensive statistics are absent for Big Data workloads as they are expensive to compute and maintain. So the Join Reordering rules are never kicked in, leaving it up to the users to take care of it. Since this critical operation is still manual and requires trial and error method, we would like to propose technique which can work on just the table sizes which can be computed during planning stage even if absent in a cheap manner.

In following subsection we would cover in details the importance of Join Reordering for widely used Join algorithms in Presto and Apache Spark. We will then present the current state of Reordering algorithm and Statistics in the prominent Big Data engines and uncover the reasons to consider new algorithm.

\begin{table}[h]
\begin{center}
\begin{tabular}{ |c|c| }
 \hline \\
Joins Processed & 3.9 million \\ \hline \\
Most common Join Type & INNER JOIN - 51\%  \\  \hline \\
Second most common Join Type &  LEFT OUTER JOIN - 31\%\\ \hline  \\
Most common Join algorithm & SortMergeJoin - 55\%\\ \hline \\
Second most common Join algorithm & BroadcastHashJoin - 44\%\\
 \hline
\end{tabular}
\label{tab:stats}
\end{center}
\caption{Join metrics collected over 1 month for Apache Spark in Qubole}
\end{table}

\input{why_jo}
\input{current_state_in_bigdata}

In above, subsection we clearly saw why traditional approaches like Cost Based Optimizations and Adaptive Execution not work well for finding optimal Join Order in Big Data. Hence, in this paper we will present a novel greedy approach for Join Reordering which can work without expensive statistics for Big Data Systems.
In the following Section ~\ref{sec:rel_work}, we will discuss the existing work done in academia for Join Reordering and their relevance to our problem statement. Then we will propose our technique and algorithm in Section~\ref{sec:jo}. We will also present experimental evaluation of the algorithm in Section~\ref{sec:exp-evaluation}.

\input{literature_survey}
\input{jo}
\input{experimental_evaluation}

\section*{Acknowledgment}

\begin{thebibliography}{00}
\bibitem{b1} Selinger, P. Griffiths, M. M., Astrahan, D. D., Chamberlin, R. A., Lorie, and T. G., Price. ``Access Path Selection in a Relational Database Management System.`` . In Proceedings of the 1979 ACM SIGMOD International Conference on Management of Data (pp. 23–34). Association for Computing Machinery, 1979.
\bibitem{b2} Amogh Margoor, Rajat Venkatesh. ``SQL Join Optimizations in Qubole Presto,``
https://medium.com/qubole-engineering/sql-join-optimizations-in-qubole-presto-3ced3dc75275, unpublished
\bibitem{b3} Guido Moerkotte and Thomas Neumann. 2006. ``Analysis of Two Existing and One New Dynamic Programming Algorithm for the Generation of Optimal Bushy Join Trees without Cross Products.`` In Proceedings of the 32nd International Conference on Very Large Data Bases, Seoul, Korea, September 12-15, 2006. 930–941.
\bibitem{b4} A. Swami ``Optimization of large join queries: combining heuristics and
combinatorial techniques.`` SIGMOD Record, vol. 18, no. 2, 1989.
\bibitem{b5} L. Fegaras ``A new heuristic for optimizing large queries in DEXA ’98``. Proceedings of the 9th International Conference on Database and Expert Systems Applications, 1998.
\bibitem{b6} N. Bruno, C. Galindo-Legaria and M. Joshi ``Polynomial Heuristics for Query Optimization``. 2010 IEEE 26th International Conference on Data Engineering (ICDE 2010), Long Beach, CA, 2010, pp. 589-600, doi: 10.1109/ICDE.2010.5447916.
\bibitem{b7} Li, Quanzhong and Shao, Minglong and Markl, Volker and Beyer, Kevin and Colby, Latha and Lohman, Guy. (2007)  ``Polynomial heuristics for query optimization,`` Proceedings - International Conference on Data Engineering. 26-35. 10.1109/ICDE.2007.367848.
\bibitem{b8} Li, Youfu and Li, Mingda and Ding, Ling and Interlandi, Matteo. (2018)  `` RIOS: Runtime Integrated Optimizer for Spark`` 275-287. 10.1145/3267809.3267814.
\end{thebibliography}

\end{document}
